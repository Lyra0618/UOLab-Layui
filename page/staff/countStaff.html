<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"> <!-- 设置字符编码为UTF-8 -->
  <title>成员统计</title> <!-- 网页标题 -->
  <meta name="renderer" content="webkit"> <!-- 优先使用webkit内核渲染 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <!-- 使IE以最新模式渲染页面 -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> <!-- 设置视口 -->
  <link rel="stylesheet" href="../../lib/layui-v2.6.3/css/layui.css" media="all"> <!-- 引入Layui的CSS文件 -->
  <link rel="stylesheet" href="../../css/public.css" media="all"> <!-- 引入公共CSS文件 -->
  <script src="../../lib/layui-v2.6.3/layui.js" charset="utf-8"></script> <!-- 引入Layui的JS文件 -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.1.2/dist/echarts.min.js"></script> <!-- 引入ECharts的JS文件 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script> <!-- 引入xlsx的JS文件 -->
</head>
<body>
<div class="layuimini-container">
  <div class="layuimini-main">
    <div class="layui-row">
      <div class="layui-col-md12">
        <div class="layui-card-body">
          <div class="layui-card" style="box-shadow: 0px 0px 10px 3px gainsboro; border-radius: 20px;">
            <div class="layui-card-header" style="font-weight: bold; font-size: 18px;"><i class="layui-icon layui-icon-export"></i>   成员统计导出</div> <!-- 成员统计导出标题 -->
            <div class="layui-card-body" style="margin: 10px 10px 1px 10px">
              <button class="layui-btn" style="margin-bottom: 10px" onclick="exportExcel()">导出Excel</button> <!-- 导出Excel按钮 -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="padding:10px;">
      <div class="layui-row layui-col-space15">
        <div class="layui-col-md12 ">
          <div class="layui-card-body">
            <div class="layui-card" style="box-shadow: 0px 0px 10px 3px gainsboro; border-radius: 20px;">
              <div class="layui-card-header" style="font-weight: bold; font-size: 18px;"><i class="layui-icon layui-icon-chart-screen"></i>    成员统计</div> <!-- 成员统计标题 -->
              <div class="layui-card-body">
                <div id="main" style="width: 100%; height: 600px;"></div> <!-- ECharts图表容器 -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // JavaScript代码区域
  layui.use('element', function(){
    var element = layui.element;
  });

  // 定义全局变量
  var $;
  layui.use(['form', 'layer', 'laydate','table'], function() {
    $ = layui.jquery; // jQuery
    var form = layui.form, // 表单模块
            layer = layui.layer, // 弹层模块
            laydate = layui.laydate, // 日期模块
            table = layui.table; // 表格模块
  });

  // ECharts 图表配置
  var chartDom = document.getElementById('main'); // 获取图表容器
  var myChart = echarts.init(chartDom); // 初始化ECharts实例
  var option;

  const posList = [
    'left', 'right', 'top', 'bottom', 'inside', 'insideTop', 'insideLeft',
    'insideRight', 'insideBottom', 'insideTopLeft', 'insideTopRight',
    'insideBottomLeft', 'insideBottomRight'
  ];
  const labelOption = {
    show: true, // 显示标签
    position: 'insideBottom', // 标签位置
    distance: 15, // 标签距离
    align: 'left', // 标签对齐
    verticalAlign: 'middle', // 标签垂直对齐
    rotate: 90, // 标签旋转
    formatter: '{c}  {name|{a}}', // 标签格式
    fontSize: 16, // 字体大小
    rich: { name: {} }
  };
  option = {
    tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } }, // 提示框配置
    legend: { data: ['年级', '专业', '状态'] }, // 图例配置
    toolbox: {
      show: true, // 显示工具箱
      orient: 'vertical', // 工具箱方向
      left: 'right', // 工具箱位置
      top: 'center', // 工具箱位置
      feature: {
        mark: { show: true }, // 标记功能
        dataView: { show: true, readOnly: false }, // 数据视图功能
        magicType: { show: true, type: ['line', 'bar', 'stack'] }, // 切换图表类型
        restore: { show: true }, // 还原功能
        saveAsImage: { show: true } // 保存为图片功能
      }
    },
    xAxis: [
      { type: 'category', axisTick: { show: false }, data: ['太原科技大学', '中北大学', '太原理工大学', '山西财经大学'] } // X轴数据
    ],
    yAxis: [{ type: 'value' }], // Y轴配置
    series: [
      { name: '年级', type: 'bar', label: labelOption, emphasis: { focus: 'series' }, data: [3, 2, 1, 2] }, // 年级数据
      { name: '专业', type: 'bar', label: labelOption, emphasis: { focus: 'series' }, data: [2, 3, 2, 1] }, // 专业数据
      { name: '状态', type: 'bar', label: labelOption, emphasis: { focus: 'series' }, data: [3, 3, 2, 2] } // 状态数据
    ]
  };
  myChart.setOption(option); // 设置图表选项

  // 导出Excel
  window.exportExcel = function() {
    var wb = XLSX.utils.book_new(); // 创建新工作簿
    var ws_data = [['学院', '年级', '专业', '状态']]; // 初始化表头

    $.getJSON('../../api/staff.json', function(data) {
      data.data.forEach(function(item) {
        ws_data.push([item.college, item.grade, item.major, item.status]); // 逐行添加数据
      });

      var ws = XLSX.utils.aoa_to_sheet(ws_data); // 将数据转换为工作表
      XLSX.utils.book_append_sheet(wb, ws, "成员统计"); // 将工作表添加到工作簿
      XLSX.writeFile(wb, "成员统计.xlsx"); // 导出Excel文件
    });
  };
</script>

</body>
</html>
